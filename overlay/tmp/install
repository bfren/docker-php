#!/bin/sh

set -euo pipefail
export BF_E=`basename ${0}`


#======================================================================================================================
# Make init and PHP ini scripts executable.
#======================================================================================================================

chmod +x /init
chmod +x /usr/local/bin/php-*


#======================================================================================================================
# Get PHP version.
#======================================================================================================================

cd /tmp

VERSION=$(cat VERSION)
bf-echo "PHP version ${VERSION}."


#======================================================================================================================
# Install PHP dependencies and packages.
#   (bash is required for php.ini configuration.)
#======================================================================================================================

bf-echo "Installing dependencies..."
apk add --no-cache \
    bash
bf-done

bf-echo "Installing PHP v${VERSION}..."
chmod +x ./install-php && ./install-php ${VERSION}
bf-done

URL="https://raw.githubusercontent.com/php/php-src/master/php.ini-production"
bf-echo "Downloading php.ini from ${URL}..."
wget -O ${PHP_DIR}/php.ini ${URL}
bf-done


#======================================================================================================================
# Cleanup.
#======================================================================================================================

bf-echo "Cleanup /www files."
rm -f /www/index.html
